> 从本章起因为代码量陡增，因此不再罗列全部代码，只对关键部分做出说明。

这一章主要做两件事情：

* 编写运行在U模式下的用户代码，这些代码会进行system call陷入S模式
* 编写运行在S模式下的操作系统代码，包括：
  * 实现system call本身
  * 加载并运行用户代码
  * 实现从U trap到S并返回的一系列准备和善后工作

这一章有想多当的细节，了解清楚每个细节能打通很多关键的经络。

# 实现用户代码



## 参考：

* [lib.rs和main.rs的关系](https://stackoverflow.com/questions/57756927/rust-modules-confusion-when-there-is-main-rs-and-lib-rs)。总结就是，将`lib.rs`当做其它第三方库对待（直接通过`use`引入）就是了。

# 实现OS代码

## 实现system call本身

## 加载并运行用户代码

## 实现从U trap到S并返回的一系列准备和善后工作











# 一些疑问

1. 因为Trap并不是普通的函数调用，因此调用的双方并没有遵循调用约定？
2. 内核中定义的栈和链接文件中的栈有什么区别
3. 

