企业架构模式学习笔记

# 引言

章节结构：第一部分是一个综述，描述了**企业应用架构**中的一些基础知识。第二部分是**针对各种具体问题而提出的解决方案**（也可以认为是针对不同问题的分层方法）。

全书主要讨论如何将企业应用组织成不同的层次，即讨论分层架构。而分层架构是单体架构中的其中1种，其它的架构风格有管道架构、微内核架构。（[关于架构、微服务、DDD之间的关系可以参考这篇文章的附录](./architecture_principle.md)）



这一章讨论了以下内容：

* 架构的定义
* 什么是企业应用
* 什么是模式

## 架构的定义

架构的定义难以统一，但一般会包含以下内容：

* 最高层次的系统分解
* 系统中不易改变的决定

Ralph Johnson认为，架构是主观的（这个不是很好理解），它描述了**系统的组成部分以及这些组成之间的关系**。而作者认为，架构涉及**企业应用主要组成部分**和他希望**尽可能做出的决定**。

## 企业应用的特点

与一些底层软件开发（例如数据库或者OS开发）对比，企业应用有以下特点：

* 涉及持久化数据
* 涉及大量数据
* 很多人同时访问数据
* 大量操作数据的客户端
* 与散布在周围的其他企业应用集成

## 模式

模式的核心就是特定的解决方案，它有效而且有足够的通用性，能解决重复出现的问题。



# 第一部分：表述

## 分层

分层架构中最难的问题是决定建立哪些层次以及各层的职责。

> 在英语上*layer*和*tier*都能表示“层”这个概念，但多数人认为*tier*意味着物理的分离，而这里讨论的更多是逻辑上的分层，不一定意味着是物理分离，因此用*layer*更加合适。

在企业应用中可以分出三个基本的层次：

* 表现层
* 领域逻辑层
* 数据源层

接下来讨论了为各层选择运行环境的问题，理论上除了数据源层需要运行在服务端，其它两层可以根据应用的性质在选择部署在服务端或客户端，而这些方案各有优劣。企业应用发展到现在，表现层基本上是以WEB界面为主的瘦客户端，因此三层都可以运行在服务端。

相比之下大型的3D游戏的架构方式和企业应用确实有明显的区别，首先它需要部署在客户机上的胖客户端，一些必要的业务逻辑也会运行在胖客户端上。



## 如何组织领域逻辑

领域逻辑的组织有三种主要模式：

| 名称                   | 优点                       | 缺点                                                     |
| ---------------------- | -------------------------- | -------------------------------------------------------- |
| 事务脚本               | 简单直接                   | 容易产生不易消除的重复代码，且难以描述日益复杂的业务逻辑 |
| 领域模型               | 能够抽象复杂的业务         | 复杂，使用难度大                                         |
| 表模块（Table Module） | 难度和抽象能力位于两者之间 | 难度和抽象能力位于两者之间                               |

注意表模块**不是数据源层的抽象，是业务逻辑的组织方式，不要将它和数据源层的*Table Data Gateway*混淆**。



* 表模块是事务脚本和领域模型之间的一个中间地带，最大优点在于**与软件架构中已有的部分衔接**。
* 使用表模块和领域模型的时候，可能会细分出一个位于它们之上的服务层，可以在服务层中放置事务控制和安全控制。服务层中放置多少业务逻辑是一个微妙的事情。（业务逻辑的多少会产生对应的[失血、贫血、充血、涨血模型](https://www.jianshu.com/p/c61c9d8478f4)？）

关于表模块和服务层的一些细节会在模式的章节里详细讨论，这里不展开。



## 映射到RMDB

由于长期使用MongoDB，这个章节看得并不是十分理解。

本节分为两个部分：**架构**和**行为**。

***架构***讨论了一些模式，这些模式将领域逻辑层（DDD/事务脚本/表模块）访问数据库的细节（例如SQL）封装起来，它采用了一个称为*入口(Gateway)*的技术。入口主要有两种：*行数据入口(Row Data Gateway)*和*表数据入口(Table Data Gateway)*。

* 当使用表模块的时候，Gateway非常适合。

* 当使用领域对象的时候，最好选择*活动记录(Active Record)*、*数据映射器(Data Mapper)*作为首选持久化机制，同时使用Gateway来封装被视为外部接口的表或者服务。

***行为***讨论的是如何把各种对象从数据库中读取出来以及存到数据库中。

>  行为这个章节太过于晦涩，稍后回来补充内容

## WEB表现层

## 并发

## 会话状态

## 分布策略

## 通盘考虑

# 第二部分：模式



